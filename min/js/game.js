"use strict";(()=>{function p(){return performance.timeOrigin+performance.now()}async function u(i){return new Promise(e=>setTimeout(e,i))}var m=(n=>(n.People="people",n.Ideas1="ideas1",n.Ideas2="ideas2",n.Ideas3="ideas3",n.Growth="growth",n.Health="health",n.Military="military",n.Influence="influence",n.Work="work",n.Exploration="exploration",n))(m||{}),c=(r=>(r[r.fixed=1]="fixed",r[r.percentage=2]="percentage",r))(c||{}),f={people:"fa-users",ideas1:"fa-lightbulb kind1",ideas2:"fa-lightbulb kind2",ideas3:"fa-lightbulb kind3",growth:"fa-signal",health:"fa-plus",military:"fa-shield-halved",influence:"fa-star",work:"fa-gavel fa-rotate-270",exploration:"fa-sun"},t=class{name;position;#e;type;rewards;cooldownEndsAt=0;constructor({name:e,position:r,level:a=0,type:d,rewards:y,cooldownEndsAt:s=0}){this.name=e,this.position=r,this.#e=a,this.type=d,this.rewards=y,this.cooldownEndsAt=s}get level(){return this.#e}get cooldown(){return Math.max(1,this.level)/Math.max(1,game.currency[`ideas${this.type}`])*1e3}get remainingCooldown(){return Math.max(0,this.cooldownEndsAt-p())}get onCooldown(){return this.remainingCooldown>0}completeUpgrade(e=1){this.#e+=e;for(let r of this.rewards)game.currency[r.kind]+=r.amount}async upgrade(e=1){e&&this.onCooldown||(this.onCooldown||(this.cooldownEndsAt=p()+this.cooldown),await u(this.remainingCooldown),this.completeUpgrade(e))}toJSON(){return{...this,level:this.level,cooldownEndsAt:this.cooldownEndsAt}}},o=class{saveVersion=1;gameSpeed=1;openPageId=0;upgradePages=[[{name:"Fire",type:2,rewards:[{kind:"exploration",type:1,amount:2}]},{name:"Gathering",type:3,rewards:[{kind:"growth",type:1,amount:2}]},{name:"Hunting",type:3,rewards:[{kind:"growth",type:1,amount:2},{kind:"exploration",type:1,amount:1}]},{name:"Tool Use",type:2,rewards:[{kind:"work",type:1,amount:3}]}],[{name:"Art",type:1,rewards:[{kind:"influence",type:1,amount:4}]},{name:"Cooking",type:3,rewards:[{kind:"health",type:1,amount:1}]},{name:"Language",type:1,rewards:[{kind:"ideas1",type:2,amount:5},{kind:"ideas2",type:2,amount:5},{kind:"ideas3",type:2,amount:5}]},{name:"Shelter",type:3,rewards:[{kind:"exploration",type:1,amount:2}]},{name:"Spears",type:2,rewards:[{kind:"military",type:1,amount:3}]}],[{name:"Burial",type:1,rewards:[{kind:"influence",type:1,amount:3}]},{name:"Clothing",type:3,rewards:[{kind:"exploration",type:1,amount:3}]},{name:"Herbalism",type:2,rewards:[{kind:"growth",type:1,amount:1},{kind:"health",type:1,amount:1}]},{name:"Shamanism",type:1,rewards:[{kind:"ideas1",type:2,amount:5},{kind:"growth",type:1,amount:3}]}],[{name:"Archery",type:3,rewards:[{kind:"military",type:1,amount:5}]},{name:"Cave Painting",type:1,rewards:[{kind:"ideas3",type:2,amount:5},{kind:"exploration",type:1,amount:1}]},{name:"Fishing",type:3,rewards:[{kind:"growth",type:1,amount:2}]},{name:"Music",type:1,rewards:[{kind:"influence",type:1,amount:2}]},{name:"Textiles",type:2,rewards:[{kind:"work",type:1,amount:3}]}],[{name:"Domestication",type:3,rewards:[{kind:"growth",type:1,amount:5}]},{name:"Pottery",type:2,rewards:[{kind:"work",type:1,amount:3},{kind:"influence",type:1,amount:2}]},{name:"Sedentism",type:3,rewards:[{kind:"work",type:1,amount:2},{kind:"health",type:1,amount:3}]},{name:"Warfare",type:1,rewards:[{kind:"military",type:1,amount:3}]}],[{name:"Agriculture",type:3,rewards:[{kind:"growth",type:1,amount:4},{kind:"health",type:1,amount:3}]},{name:"Artisans",type:1,rewards:[{kind:"military",type:1,amount:1},{kind:"work",type:1,amount:3},{kind:"influence",type:1,amount:3}]},{name:"Canoe",type:3,rewards:[{kind:"exploration",type:1,amount:3},{kind:"military",type:1,amount:1}]},{name:"Symbology",type:2,rewards:[{kind:"ideas2",type:2,amount:5}]}],[{name:"Brewing",type:3,rewards:[{kind:"health",type:1,amount:4}]},{name:"Expeditions",type:1,rewards:[{kind:"exploration",type:1,amount:4}]},{name:"Irrigation",type:2,rewards:[{kind:"growth",type:1,amount:4},{kind:"work",type:1,amount:2}]},{name:"Megaliths",type:1,rewards:[{kind:"influence",type:1,amount:4}]},{name:"Weaving",type:3,rewards:[{kind:"work",type:1,amount:4}]}],[{name:"Architecture",type:1,rewards:[{kind:"health",type:1,amount:5},{kind:"influence",type:1,amount:5}]},{name:"Sailing",type:3,rewards:[{kind:"exploration",type:1,amount:5}]},{name:"Smelting",type:3,rewards:[{kind:"military",type:1,amount:8},{kind:"work",type:1,amount:4}]},{name:"Wheel",type:2,rewards:[{kind:"work",type:1,amount:6}]}],[{name:"Bronze Working",type:3,rewards:[{kind:"military",type:1,amount:4},{kind:"work",type:1,amount:8}]},{name:"Government",type:1,rewards:[{kind:"exploration",type:1,amount:2},{kind:"health",type:1,amount:6}]},{name:"Horseback Riding",type:3,rewards:[{kind:"exploration",type:1,amount:4},{kind:"military",type:1,amount:3}]},{name:"Plough",type:2,rewards:[{kind:"growth",type:1,amount:12}]},{name:"Writing",type:2,rewards:[{kind:"ideas1",type:2,amount:5},{kind:"ideas2",type:2,amount:5},{kind:"ideas3",type:2,amount:5}]}],[{name:"Mathematics",type:2,rewards:[{kind:"ideas2",type:2,amount:5}]},{name:"Monarchism",type:1,rewards:[{kind:"influence",type:1,amount:12}]},{name:"Money",type:3,rewards:[{kind:"work",type:1,amount:8},{kind:"influence",type:1,amount:4}]},{name:"Shipbuilding",type:2,rewards:[{kind:"exploration",type:1,amount:6},{kind:"military",type:1,amount:2}]},{name:"Swords",type:2,rewards:[{kind:"military",type:1,amount:6}]}],[{name:"Calendar",type:2,rewards:[{kind:"growth",type:1,amount:16},{kind:"work",type:1,amount:4}]},{name:"Law",type:1,rewards:[{kind:"military",type:1,amount:6},{kind:"health",type:1,amount:6}]},{name:"Libraries",type:3,rewards:[{kind:"ideas3",type:2,amount:5},{kind:"influence",type:1,amount:4}]},{name:"Sewers",type:3,rewards:[{kind:"health",type:1,amount:10}]},{name:"Sundial",type:2,rewards:[{kind:"exploration",type:1,amount:10},{kind:"work",type:1,amount:4}]}]].map(e=>Object.fromEntries(e.map((r,a)=>[r.name,new t({position:a,...r})])));currency={people:0,ideas1:0,ideas2:0,ideas3:0,growth:0,health:0,military:0,influence:0,work:0,exploration:0};#e=!1;get openPage(){return this.upgradePages[this.openPageId]}save(){globalThis.localStorage.setItem("gameSave",btoa(JSON.stringify(this)))}load(e={}){return this.saveVersion=e.saveVersion??this.saveVersion,this.gameSpeed=e.gameSpeed??this.gameSpeed,this.openPageId=e.openPageId??this.openPageId,e.upgradePages&&(this.upgradePages=this.upgradePages.map((r,a)=>Object.fromEntries(Object.entries(r).map(([d,y])=>[d,new t({...y,...e.upgradePages?.[a]?.[d]})])))),this.currency=e.currency??this.currency,this}loadFromLocalStorage(){let e=globalThis.localStorage.getItem("gameSave");if(!e)return this;let r=JSON.parse(atob(e));if(Array.isArray(r)&&(r=r[0]),!r)return this;if(typeof r!="object"||Array.isArray(r))throw new Error("Invalid save data from localStorage");if(!r.saveVersion||r.saveVersion<1)throw new Error("Unsupported saveData version");return this.load(r)}deleteSave(){globalThis.localStorage.removeItem("gameSave");let e=new this.constructor;return this.saveVersion=e.saveVersion,this.gameSpeed=e.gameSpeed,this.openPageId=e.openPageId,this.upgradePages=e.upgradePages,this}registerAutoSave(){if(this.#e)throw new Error("Do not register autosave twice!");return document.addEventListener("visibilitychange",()=>{document.visibilityState=="hidden"&&this.save()}),window.addEventListener("pagehide",()=>this.save()),this.#e=!0,this}};})();
//# sourceMappingURL=game.js.map
