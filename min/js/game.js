function o(){return performance.timeOrigin+performance.now()}async function u(i){return new Promise(r=>{setTimeout(r,i)})}var m=(n=>(n.People="people",n.Ideas1="ideas1",n.Ideas2="ideas2",n.Ideas3="ideas3",n.Growth="growth",n.Health="health",n.Military="military",n.Influence="influence",n.Work="work",n.Exploration="exploration",n))(m||{}),c=(e=>(e[e.fixed=1]="fixed",e[e.percentage=2]="percentage",e))(c||{}),T={people:"fa-users",ideas1:"fa-lightbulb kind1",ideas2:"fa-lightbulb kind2",ideas3:"fa-lightbulb kind3",growth:"fa-signal",health:"fa-plus",military:"fa-shield-halved",influence:"fa-star",work:"fa-gavel fa-rotate-270",exploration:"fa-sun"},t=class{name;position;#e;type;rewards;cooldownEndsAt=0;constructor({name:r,position:e,level:a=0,type:d,rewards:y,cooldownEndsAt:s=0}){this.name=r,this.position=e,this.#e=a,this.type=d,this.rewards=y,this.cooldownEndsAt=s}get level(){return this.#e}get cooldown(){return Math.max(1,this.level)/Math.max(1,game.currency[`ideas${this.type}`])*this.rewards.length*1e3}get remainingCooldown(){return Math.max(0,this.cooldownEndsAt-o())}get onCooldown(){return this.remainingCooldown>0}completeUpgrade(r=1){this.#e+=r;for(let e of this.rewards)game.currency[e.kind]+=e.amount}async upgrade(r=1){r&&this.onCooldown||(this.onCooldown||(this.cooldownEndsAt=o()+this.cooldown),await u(this.remainingCooldown),this.completeUpgrade(r))}toJSON(){return{...this,level:this.level,cooldownEndsAt:this.cooldownEndsAt}}},p=class{saveVersion=1;gameSpeed=1;openPageId=0;upgradePages=[[{name:"Fire",type:2,rewards:[{kind:"exploration",type:1,amount:2}]},{name:"Gathering",type:3,rewards:[{kind:"growth",type:1,amount:2}]},{name:"Hunting",type:3,rewards:[{kind:"growth",type:1,amount:2},{kind:"exploration",type:1,amount:1}]},{name:"Tool Use",type:2,rewards:[{kind:"work",type:1,amount:3}]}],[{name:"Art",type:1,rewards:[{kind:"influence",type:1,amount:4}]},{name:"Cooking",type:3,rewards:[{kind:"health",type:1,amount:1}]},{name:"Language",type:1,rewards:[{kind:"ideas1",type:2,amount:5},{kind:"ideas2",type:2,amount:5},{kind:"ideas3",type:2,amount:5}]},{name:"Shelter",type:3,rewards:[{kind:"exploration",type:1,amount:2}]},{name:"Spears",type:2,rewards:[{kind:"military",type:1,amount:3}]}],[{name:"Burial",type:1,rewards:[{kind:"influence",type:1,amount:3}]},{name:"Clothing",type:3,rewards:[{kind:"exploration",type:1,amount:3}]},{name:"Herbalism",type:2,rewards:[{kind:"growth",type:1,amount:1},{kind:"health",type:1,amount:1}]},{name:"Shamanism",type:1,rewards:[{kind:"ideas1",type:2,amount:5},{kind:"growth",type:1,amount:3}]}],[{name:"Archery",type:3,rewards:[{kind:"military",type:1,amount:5}]},{name:"Cave Painting",type:1,rewards:[{kind:"ideas3",type:2,amount:5},{kind:"exploration",type:1,amount:1}]},{name:"Fishing",type:3,rewards:[{kind:"growth",type:1,amount:2}]},{name:"Music",type:1,rewards:[{kind:"influence",type:1,amount:2}]},{name:"Textiles",type:2,rewards:[{kind:"work",type:1,amount:3}]}],[{name:"Domestication",type:3,rewards:[{kind:"growth",type:1,amount:5}]},{name:"Pottery",type:2,rewards:[{kind:"work",type:1,amount:3},{kind:"influence",type:1,amount:2}]},{name:"Sedentism",type:3,rewards:[{kind:"work",type:1,amount:2},{kind:"health",type:1,amount:3}]},{name:"Warfare",type:1,rewards:[{kind:"military",type:1,amount:3}]}],[{name:"Agriculture",type:3,rewards:[{kind:"growth",type:1,amount:4},{kind:"health",type:1,amount:3}]},{name:"Artisans",type:1,rewards:[{kind:"military",type:1,amount:1},{kind:"work",type:1,amount:3},{kind:"influence",type:1,amount:3}]},{name:"Canoe",type:3,rewards:[{kind:"exploration",type:1,amount:3},{kind:"military",type:1,amount:1}]},{name:"Symbology",type:2,rewards:[{kind:"ideas2",type:2,amount:5}]}],[{name:"Brewing",type:3,rewards:[{kind:"health",type:1,amount:4}]},{name:"Expeditions",type:1,rewards:[{kind:"exploration",type:1,amount:4}]},{name:"Irrigation",type:2,rewards:[{kind:"growth",type:1,amount:4},{kind:"work",type:1,amount:2}]},{name:"Megaliths",type:1,rewards:[{kind:"influence",type:1,amount:4}]},{name:"Weaving",type:3,rewards:[{kind:"work",type:1,amount:4}]}],[{name:"Architecture",type:1,rewards:[{kind:"health",type:1,amount:5},{kind:"influence",type:1,amount:5}]},{name:"Sailing",type:3,rewards:[{kind:"exploration",type:1,amount:5}]},{name:"Smelting",type:3,rewards:[{kind:"military",type:1,amount:8},{kind:"work",type:1,amount:4}]},{name:"Wheel",type:2,rewards:[{kind:"work",type:1,amount:6}]}],[{name:"Bronze Working",type:3,rewards:[{kind:"military",type:1,amount:4},{kind:"work",type:1,amount:8}]},{name:"Government",type:1,rewards:[{kind:"exploration",type:1,amount:2},{kind:"health",type:1,amount:6}]},{name:"Horseback Riding",type:3,rewards:[{kind:"exploration",type:1,amount:4},{kind:"military",type:1,amount:3}]},{name:"Plough",type:2,rewards:[{kind:"growth",type:1,amount:12}]},{name:"Writing",type:2,rewards:[{kind:"ideas1",type:2,amount:5},{kind:"ideas2",type:2,amount:5},{kind:"ideas3",type:2,amount:5}]}],[{name:"Mathematics",type:2,rewards:[{kind:"ideas2",type:2,amount:5}]},{name:"Monarchism",type:1,rewards:[{kind:"influence",type:1,amount:12}]},{name:"Money",type:3,rewards:[{kind:"work",type:1,amount:8},{kind:"influence",type:1,amount:4}]},{name:"Shipbuilding",type:2,rewards:[{kind:"exploration",type:1,amount:6},{kind:"military",type:1,amount:2}]},{name:"Swords",type:2,rewards:[{kind:"military",type:1,amount:6}]}],[{name:"Calendar",type:2,rewards:[{kind:"growth",type:1,amount:16},{kind:"work",type:1,amount:4}]},{name:"Law",type:1,rewards:[{kind:"military",type:1,amount:6},{kind:"health",type:1,amount:6}]},{name:"Libraries",type:3,rewards:[{kind:"ideas3",type:2,amount:5},{kind:"influence",type:1,amount:4}]},{name:"Sewers",type:3,rewards:[{kind:"health",type:1,amount:10}]},{name:"Sundial",type:2,rewards:[{kind:"exploration",type:1,amount:10},{kind:"work",type:1,amount:4}]}]].map(r=>Object.fromEntries(r.map((e,a)=>[e.name,new t({position:a,...e})])));currency={people:0,ideas1:0,ideas2:0,ideas3:0,growth:0,health:0,military:0,influence:0,work:0,exploration:0};#e=!1;#r=!1;get openPage(){return this.upgradePages[this.openPageId]}save(){this.#r||globalThis.localStorage.setItem("gameSave",btoa(JSON.stringify(this)))}load(r={}){return this.saveVersion=r.saveVersion??this.saveVersion,this.gameSpeed=r.gameSpeed??this.gameSpeed,this.openPageId=r.openPageId??this.openPageId,r.upgradePages&&(this.upgradePages=this.upgradePages.map((e,a)=>Object.fromEntries(Object.entries(e).map(([d,y])=>[d,new t({...y,...r.upgradePages?.[a]?.[d]})])))),this.currency=r.currency??this.currency,this.currency.ideas1||=1,this.currency.ideas2||=1,this.currency.ideas3||=1,this}loadFromLocalStorage(){let r=globalThis.localStorage.getItem("gameSave");if(!r)return this;let e=JSON.parse(atob(r));if(Array.isArray(e)&&(e=e[0]),!e)return this;if(typeof e!="object"||Array.isArray(e))throw new Error("Invalid save data from localStorage");if(!e.saveVersion||e.saveVersion<1)throw new Error("Unsupported saveData version");return this.load(e)}deleteSave(){this.#r=!0,globalThis.localStorage.removeItem("gameSave"),globalThis.location.reload()}registerAutoSave(){if(this.#e)throw new Error("Do not register autosave twice!");return document.addEventListener("visibilitychange",()=>{document.visibilityState=="hidden"&&this.save()}),window.addEventListener("pagehide",()=>this.save()),this.#e=!0,this}};export{T as CurrencyIconClass,m as CurrencyKind,c as RewardType,t as Upgrade,p as default};
//# sourceMappingURL=game.js.map
