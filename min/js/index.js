import Game,{CurrencyIconClass}from"./game.js";import{centerActiveButton,romanize}from"./utils.js";let upgradeContainer=document.querySelector("#upgrades-container"),upgradesGroupList=document.querySelector("#upgrades-group-buttons"),activeElementParents=[...new Set(document.querySelectorAll(":has(>.active)"))],upgradesGroupListScrollBack;for(let t of activeElementParents)t.addEventListener("click",e=>{var e=e.target.closest("button");e&&t.contains(e)&&(e=e.closest("li, .tab"))&&(t.querySelector(".active")?.classList.remove("active"),e.classList.add("active"),centerActiveButton(e))});upgradeContainer.addEventListener("click",e=>{var t;e.target instanceof Element&&(e=e.target.closest(".upgrade"))&&(t=game.openPage[e.querySelector(".up-name").textContent],e=e.querySelector(".up-level"),t.level++,e.textContent=t.level.toLocaleString())}),upgradesGroupList.addEventListener("wheel",e=>{e.deltaY&&(e.preventDefault(),upgradesGroupList.scrollLeft=Math.max(0,Math.min(upgradesGroupList.scrollLeft+e.deltaY,upgradesGroupList.scrollWidth-upgradesGroupList.clientWidth)),clearTimeout(upgradesGroupListScrollBack),upgradesGroupListScrollBack=setTimeout(centerActiveButton,1e4))},{passive:!1}),upgradesGroupList.addEventListener("click",t=>{if(t.target instanceof HTMLButtonElement){var r,n,t=[...upgradesGroupList.children].indexOf(t.target.parentElement),t=(game.openPageId=t,Object.entries(game.openPage));for([r,n]of t){var o=upgradeContainer.children.item(n.position);o.querySelector(".up-level").textContent=n.level.toLocaleString(),o.querySelector(".up-name").textContent=r,o.setAttribute("type",n.type.toString());let e=o.querySelector(".up-improvements-container"),a=e.querySelector(".up-imp");e.replaceChildren(...n.rewards.map(e=>{var t,r=a.cloneNode(!0),n=(r.querySelector("p > .sign").textContent=0<e.amount?"+":"-",r.querySelector("p > .value").textContent=e.amount.toLocaleString(),r.querySelector("p > .unit").textContent="percentage"==e.type?"%":"",r.querySelector(".up-imp-icon"));for(t of Object.values(CurrencyIconClass))n.classList.remove(...t.split(" "));return n.classList.add(...CurrencyIconClass[e.kind].split(" ")),r})),o.classList.remove("hidden")}for(let e=t.length;e<upgradeContainer.children.length;e++)upgradeContainer.children.item(e)?.classList.add("hidden")}}),document.addEventListener("DOMContentLoaded",()=>{globalThis.game=(new Game).loadFromLocalStorage().registerAutoSave();for(let e=0;e<4;e++)upgradeContainer.append(upgradeContainer.firstElementChild.cloneNode(!0));for(let t=0;t<game.upgradePages.length;t++){let e;t?(e=document.createElement("li")).append(...upgradesGroupList.firstElementChild.childNodes.values().map(e=>e.cloneNode())):e=upgradesGroupList.firstElementChild,e.children[0].textContent=romanize(t+1),t&&upgradesGroupList.append(e)}centerActiveButton(upgradesGroupList.children[game.openPageId]),upgradesGroupList.children[game.openPageId].firstChild.click()});