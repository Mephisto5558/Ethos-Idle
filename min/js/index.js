import Game from"./game.js";import{centerActiveButton,romanize}from"./utils.js";let upgradeContainer=document.querySelector("#upgrades-container"),upgradesGroupList=document.querySelector("#upgrades-group-buttons"),activeElementParents=[...new Set(document.querySelectorAll(":has(>.active)"))],upgradesGroupListScrollBack;for(let t of activeElementParents)t.addEventListener("click",e=>{var e=e.target.closest("button");e&&t.contains(e)&&(e=e.closest("li, .tab"))&&(t.querySelector(".active")?.classList.remove("active"),e.classList.add("active"),centerActiveButton(e))});upgradeContainer.addEventListener("click",e=>{var t;e.target instanceof Element&&(e=e.target.closest(".upgrade"))&&(t=game.openPage[e.querySelector(".up-name").textContent],e=e.querySelector(".up-level"),t.level++,e.textContent=t.level.toLocaleString())}),upgradesGroupList.addEventListener("wheel",e=>{e.deltaY&&(e.preventDefault(),upgradesGroupList.scrollLeft=Math.max(0,Math.min(upgradesGroupList.scrollLeft+e.deltaY,upgradesGroupList.scrollWidth-upgradesGroupList.clientWidth)),clearTimeout(upgradesGroupListScrollBack),upgradesGroupListScrollBack=setTimeout(centerActiveButton,1e4))},{passive:!1}),upgradesGroupList.addEventListener("click",t=>{if(t.target instanceof HTMLButtonElement){var e,r,t=[...upgradesGroupList.children].indexOf(t.target.parentElement),t=(game.openPageId=t,Object.entries(game.openPage));for([e,r]of t){var a=upgradeContainer.children.item(r.position);a.querySelector(".up-level").textContent=r.level.toLocaleString(),a.querySelector(".up-name").textContent=e,a.setAttribute("type",r.type.toString()),a.classList.remove("hidden")}for(let e=t.length;e<upgradeContainer.children.length;e++)upgradeContainer.children.item(e)?.classList.add("hidden")}}),document.addEventListener("DOMContentLoaded",()=>{globalThis.game=(new Game).loadFromLocalStorage().registerAutoSave();for(let e=0;e<4;e++)upgradeContainer.append(upgradeContainer.firstElementChild.cloneNode(!0));for(let t=0;t<15;t++){let e;t?(e=document.createElement("li")).append(...upgradesGroupList.firstElementChild.childNodes.values().map(e=>e.cloneNode())):e=upgradesGroupList.firstElementChild,e.children[0].textContent=romanize(t+1),t&&upgradesGroupList.append(e)}centerActiveButton(upgradesGroupList.children[game.openPageId]),upgradesGroupList.children[game.openPageId].firstChild.click()});