var E=[["M",1e3],["CM",900],["D",500],["CD",400],["C",100],["XC",90],["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]];function C(n){let e="";for(let[r,t]of E)for(;n>=t;)e+=r,n-=t;return e}function w(n){n?.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}function p(){return performance.timeOrigin+performance.now()}async function f(n){return new Promise(e=>{setTimeout(e,n)})}var h={people:"fa-users",ideas1:"fa-lightbulb kind1",ideas2:"fa-lightbulb kind2",ideas3:"fa-lightbulb kind3",growth:"fa-signal",health:"fa-plus",military:"fa-shield-halved",influence:"fa-star",work:"fa-gavel fa-rotate-270",exploration:"fa-sun"},g=class{name;position;#e;type;rewards;cooldownEndsAt=0;constructor({name:e,position:r,level:t=0,type:a,rewards:d,cooldownEndsAt:c=0}){this.name=e,this.position=r,this.#e=t,this.type=a,this.rewards=d,this.cooldownEndsAt=c}get level(){return this.#e}get cooldown(){return Math.max(1,this.level)/Math.max(1,game.currency[`ideas${this.type}`])*this.rewards.length*1e3}get remainingCooldown(){return Math.max(0,this.cooldownEndsAt-p())}get onCooldown(){return this.remainingCooldown>0}completeUpgrade(e=1){this.#e+=e;for(let r of this.rewards)game.currency[r.kind]+=r.amount}async upgrade(e=1){e&&this.onCooldown||(this.onCooldown||(this.cooldownEndsAt=p()+this.cooldown),await f(this.remainingCooldown),this.completeUpgrade(e))}toJSON(){return{...this,level:this.level,cooldownEndsAt:this.cooldownEndsAt}}},u=class{saveVersion=1;gameSpeed=1;openPageId=0;upgradePages=[[{name:"Fire",type:2,rewards:[{kind:"exploration",type:1,amount:2}]},{name:"Gathering",type:3,rewards:[{kind:"growth",type:1,amount:2}]},{name:"Hunting",type:3,rewards:[{kind:"growth",type:1,amount:2},{kind:"exploration",type:1,amount:1}]},{name:"Tool Use",type:2,rewards:[{kind:"work",type:1,amount:3}]}],[{name:"Art",type:1,rewards:[{kind:"influence",type:1,amount:4}]},{name:"Cooking",type:3,rewards:[{kind:"health",type:1,amount:1}]},{name:"Language",type:1,rewards:[{kind:"ideas1",type:2,amount:5},{kind:"ideas2",type:2,amount:5},{kind:"ideas3",type:2,amount:5}]},{name:"Shelter",type:3,rewards:[{kind:"exploration",type:1,amount:2}]},{name:"Spears",type:2,rewards:[{kind:"military",type:1,amount:3}]}],[{name:"Burial",type:1,rewards:[{kind:"influence",type:1,amount:3}]},{name:"Clothing",type:3,rewards:[{kind:"exploration",type:1,amount:3}]},{name:"Herbalism",type:2,rewards:[{kind:"growth",type:1,amount:1},{kind:"health",type:1,amount:1}]},{name:"Shamanism",type:1,rewards:[{kind:"ideas1",type:2,amount:5},{kind:"growth",type:1,amount:3}]}],[{name:"Archery",type:3,rewards:[{kind:"military",type:1,amount:5}]},{name:"Cave Painting",type:1,rewards:[{kind:"ideas3",type:2,amount:5},{kind:"exploration",type:1,amount:1}]},{name:"Fishing",type:3,rewards:[{kind:"growth",type:1,amount:2}]},{name:"Music",type:1,rewards:[{kind:"influence",type:1,amount:2}]},{name:"Textiles",type:2,rewards:[{kind:"work",type:1,amount:3}]}],[{name:"Domestication",type:3,rewards:[{kind:"growth",type:1,amount:5}]},{name:"Pottery",type:2,rewards:[{kind:"work",type:1,amount:3},{kind:"influence",type:1,amount:2}]},{name:"Sedentism",type:3,rewards:[{kind:"work",type:1,amount:2},{kind:"health",type:1,amount:3}]},{name:"Warfare",type:1,rewards:[{kind:"military",type:1,amount:3}]}],[{name:"Agriculture",type:3,rewards:[{kind:"growth",type:1,amount:4},{kind:"health",type:1,amount:3}]},{name:"Artisans",type:1,rewards:[{kind:"military",type:1,amount:1},{kind:"work",type:1,amount:3},{kind:"influence",type:1,amount:3}]},{name:"Canoe",type:3,rewards:[{kind:"exploration",type:1,amount:3},{kind:"military",type:1,amount:1}]},{name:"Symbology",type:2,rewards:[{kind:"ideas2",type:2,amount:5}]}],[{name:"Brewing",type:3,rewards:[{kind:"health",type:1,amount:4}]},{name:"Expeditions",type:1,rewards:[{kind:"exploration",type:1,amount:4}]},{name:"Irrigation",type:2,rewards:[{kind:"growth",type:1,amount:4},{kind:"work",type:1,amount:2}]},{name:"Megaliths",type:1,rewards:[{kind:"influence",type:1,amount:4}]},{name:"Weaving",type:3,rewards:[{kind:"work",type:1,amount:4}]}],[{name:"Architecture",type:1,rewards:[{kind:"health",type:1,amount:5},{kind:"influence",type:1,amount:5}]},{name:"Sailing",type:3,rewards:[{kind:"exploration",type:1,amount:5}]},{name:"Smelting",type:3,rewards:[{kind:"military",type:1,amount:8},{kind:"work",type:1,amount:4}]},{name:"Wheel",type:2,rewards:[{kind:"work",type:1,amount:6}]}],[{name:"Bronze Working",type:3,rewards:[{kind:"military",type:1,amount:4},{kind:"work",type:1,amount:8}]},{name:"Government",type:1,rewards:[{kind:"exploration",type:1,amount:2},{kind:"health",type:1,amount:6}]},{name:"Horseback Riding",type:3,rewards:[{kind:"exploration",type:1,amount:4},{kind:"military",type:1,amount:3}]},{name:"Plough",type:2,rewards:[{kind:"growth",type:1,amount:12}]},{name:"Writing",type:2,rewards:[{kind:"ideas1",type:2,amount:5},{kind:"ideas2",type:2,amount:5},{kind:"ideas3",type:2,amount:5}]}],[{name:"Mathematics",type:2,rewards:[{kind:"ideas2",type:2,amount:5}]},{name:"Monarchism",type:1,rewards:[{kind:"influence",type:1,amount:12}]},{name:"Money",type:3,rewards:[{kind:"work",type:1,amount:8},{kind:"influence",type:1,amount:4}]},{name:"Shipbuilding",type:2,rewards:[{kind:"exploration",type:1,amount:6},{kind:"military",type:1,amount:2}]},{name:"Swords",type:2,rewards:[{kind:"military",type:1,amount:6}]}],[{name:"Calendar",type:2,rewards:[{kind:"growth",type:1,amount:16},{kind:"work",type:1,amount:4}]},{name:"Law",type:1,rewards:[{kind:"military",type:1,amount:6},{kind:"health",type:1,amount:6}]},{name:"Libraries",type:3,rewards:[{kind:"ideas3",type:2,amount:5},{kind:"influence",type:1,amount:4}]},{name:"Sewers",type:3,rewards:[{kind:"health",type:1,amount:10}]},{name:"Sundial",type:2,rewards:[{kind:"exploration",type:1,amount:10},{kind:"work",type:1,amount:4}]}]].map(e=>Object.fromEntries(e.map((r,t)=>[r.name,new g({position:t,...r})])));currency={people:0,ideas1:0,ideas2:0,ideas3:0,growth:0,health:0,military:0,influence:0,work:0,exploration:0};#e=!1;#n=!1;get openPage(){return this.upgradePages[this.openPageId]}save(){this.#n||globalThis.localStorage.setItem("gameSave",btoa(JSON.stringify(this)))}load(e={}){return this.saveVersion=e.saveVersion??this.saveVersion,this.gameSpeed=e.gameSpeed??this.gameSpeed,this.openPageId=e.openPageId??this.openPageId,e.upgradePages&&(this.upgradePages=this.upgradePages.map((r,t)=>Object.fromEntries(Object.entries(r).map(([a,d])=>[a,new g({...d,...e.upgradePages?.[t]?.[a]})])))),this.currency=e.currency??this.currency,this.currency.ideas1||=1,this.currency.ideas2||=1,this.currency.ideas3||=1,this}loadFromLocalStorage(){let e=globalThis.localStorage.getItem("gameSave");if(!e)return this;let r=JSON.parse(atob(e));if(Array.isArray(r)&&(r=r[0]),!r)return this;if(typeof r!="object"||Array.isArray(r))throw new Error("Invalid save data from localStorage");if(!r.saveVersion||r.saveVersion<1)throw new Error("Unsupported saveData version");return this.load(r)}deleteSave(){this.#n=!0,globalThis.localStorage.removeItem("gameSave"),globalThis.location.reload()}registerAutoSave(){if(this.#e)throw new Error("Do not register autosave twice!");return document.addEventListener("visibilitychange",()=>{document.visibilityState=="hidden"&&this.save()}),window.addEventListener("pagehide",()=>this.save()),this.#e=!0,this}};var y=document.querySelector("#main-menu"),l;document.querySelector("header > #menu-btn").addEventListener("click",()=>y.classList.toggle("hidden"));y.addEventListener("click",n=>{n.target instanceof HTMLButtonElement&&(l=y.querySelector(`#${n.target.id.replace("-btn","")}`),l.classList.add("child-no-hide"),y.classList.add("hide-children"))});document.querySelector("#main-menu > #menu-back-btn").addEventListener("click",()=>{l?(l.classList.remove("child-no-hide"),y.classList.remove("hide-children"),l=void 0):y.classList.toggle("hidden")});var o=document.querySelector("#upgrades-container"),i=document.querySelector("#upgrades-group-buttons"),x=Object.fromEntries([...document.querySelectorAll("footer > #items > div > div")].map(n=>[n.id,Object.fromEntries([...n.querySelector("p").children].map(e=>[e.classList[0],e]))])),S=[...new Set(document.querySelectorAll(":has(>.active)"))],k;function v(n,e,r){e.style.removeProperty("transition"),e.style.removeProperty("transform"),n.querySelector(".up-level").textContent=r.level.toLocaleString();for(let t of r.rewards)x[t.kind].value.textContent=game.currency[t.kind].toLocaleString()}function I(n,e,r=0){let t=n.querySelector(".up-progressbar");t.style.transition="none",t.style.transform=`scaleX(${r})`,t.offsetWidth,t.style.transition=`transform ${e}ms linear`,t.style.transform="scaleX(1)"}async function b(){for(let n of o.querySelectorAll(".upgrade:not(.hidden)")){let e=game.openPage[n.querySelector(".up-name").textContent];if(!e?.onCooldown)continue;let r=e.cooldownEndsAt-p(),t=(e.cooldown-r)/e.cooldown;I(n,r,t),await f(e.remainingCooldown),e.completeUpgrade(),v(n,n.querySelector(".up-progressbar"),e)}}for(let n of S)n.addEventListener("click",e=>{let r=e.target,t=r.closest("button");if(!t||!n.contains(t))return;let a=t.closest("li, .tab");a&&(n.querySelector(".active")?.classList.remove("active"),a.classList.add("active"),w(a))});o.addEventListener("click",async n=>{let e=n.target.closest(".upgrade");if(!e)return;let r=game.openPage[e.querySelector(".up-name").textContent];!r||r.onCooldown||(I(e,r.cooldown),await r.upgrade(),v(e,e.querySelector(".up-progressbar"),r))});i.addEventListener("wheel",n=>{n.deltaY&&(n.preventDefault(),i.scrollLeft=Math.max(0,Math.min(i.scrollLeft+n.deltaY,i.scrollWidth-i.clientWidth)),clearTimeout(k),k=setTimeout(w,1e4))},{passive:!1});i.addEventListener("click",n=>{if(!(n.target instanceof HTMLButtonElement))return;let e=[...i.children].indexOf(n.target.parentElement);game.openPageId=e;let r=Object.entries(game.openPage);for(let[t,a]of r){let d=o.children.item(a.position);d.querySelector(".up-level").textContent=a.level?a.level.toLocaleString():"",d.querySelector(".up-name").textContent=t,d.setAttribute("type",a.type.toString());let c=d.querySelector(".up-improvements-container"),R=c.querySelector(".up-imp");c.replaceChildren(...a.rewards.map(m=>{let s=R.cloneNode(!0);s.querySelector("p > .sign").textContent=m.amount>0?"+":"-",s.querySelector("p > .value").textContent=m.amount.toLocaleString(),s.querySelector("p > .unit").textContent=m.type==2?"%":"";let T=s.querySelector(".up-imp-icon");for(let K of Object.values(h))T.classList.remove(...K.split(" "));return T.classList.add(...h[m.kind].split(" ")),s})),d.classList.remove("hidden")}for(let t=r.length;t<o.children.length;t++)o.children.item(t)?.classList.add("hidden")});document.addEventListener("DOMContentLoaded",async()=>{globalThis.game=new u().loadFromLocalStorage().registerAutoSave();for(let n=0;n<4;n++)o.append(o.firstElementChild.cloneNode(!0));for(let n=0;n<game.upgradePages.length;n++){let e;n?(e=document.createElement("li"),e.append(...i.firstElementChild.childNodes.values().map(r=>r.cloneNode()))):e=i.firstElementChild,e.children[0].textContent=C(n+1),n&&i.append(e)}for(let[n,e]of Object.entries(x))e.value.textContent=game.currency[n].toLocaleString();w(i.children[game.openPageId]),i.children[game.openPageId].firstChild.click(),await b()});
//# sourceMappingURL=index.js.map
