"use strict";(()=>{var c={people:"fa-users",ideas1:"fa-lightbulb kind1",ideas2:"fa-lightbulb kind2",ideas3:"fa-lightbulb kind3",growth:"fa-signal",health:"fa-plus",military:"fa-shield-halved",influence:"fa-star",work:"fa-gavel fa-rotate-270",exploration:"fa-sun"},y=class{saveVersion=1;gameSpeed=1;openPageId=0;upgradePages=[[{name:"Fire",type:2,rewards:[{kind:"exploration",type:"fixed",amount:2}]},{name:"Gathering",type:3,rewards:[{kind:"growth",type:"fixed",amount:2}]},{name:"Hunting",type:3,rewards:[{kind:"growth",type:"fixed",amount:2},{kind:"exploration",type:"fixed",amount:1}]},{name:"Tool Use",type:2,rewards:[{kind:"work",type:"fixed",amount:3}]}],[{name:"Art",type:1,rewards:[{kind:"influence",type:"fixed",amount:4}]},{name:"Cooking",type:3,rewards:[{kind:"health",type:"fixed",amount:1}]},{name:"Language",type:1,rewards:[{kind:"ideas1",type:"percentage",amount:5},{kind:"ideas2",type:"percentage",amount:5},{kind:"ideas3",type:"percentage",amount:5}]},{name:"Shelter",type:3,rewards:[{kind:"exploration",type:"fixed",amount:2}]},{name:"Spears",type:2,rewards:[{kind:"military",type:"fixed",amount:3}]}],[{name:"Burial",type:1,rewards:[{kind:"influence",type:"fixed",amount:3}]},{name:"Clothing",type:3,rewards:[{kind:"exploration",type:"fixed",amount:3}]},{name:"Herbalism",type:2,rewards:[{kind:"growth",type:"fixed",amount:1},{kind:"health",type:"fixed",amount:1}]},{name:"Shamanism",type:1,rewards:[{kind:"ideas1",type:"percentage",amount:5},{kind:"growth",type:"fixed",amount:3}]}],[{name:"Archery",type:3,rewards:[{kind:"military",type:"fixed",amount:5}]},{name:"Cave Painting",type:1,rewards:[{kind:"ideas3",type:"percentage",amount:5},{kind:"exploration",type:"fixed",amount:1}]},{name:"Fishing",type:3,rewards:[{kind:"growth",type:"fixed",amount:2}]},{name:"Music",type:1,rewards:[{kind:"influence",type:"fixed",amount:2}]},{name:"Textiles",type:2,rewards:[{kind:"work",type:"fixed",amount:3}]}],[{name:"Domestication",type:3,rewards:[{kind:"growth",type:"fixed",amount:5}]},{name:"Pottery",type:2,rewards:[{kind:"work",type:"fixed",amount:3},{kind:"influence",type:"fixed",amount:2}]},{name:"Sedentism",type:3,rewards:[{kind:"work",type:"fixed",amount:2},{kind:"health",type:"fixed",amount:3}]},{name:"Warfare",type:1,rewards:[{kind:"military",type:"fixed",amount:3}]}],[{name:"Agriculture",type:3,rewards:[{kind:"growth",type:"fixed",amount:4},{kind:"health",type:"fixed",amount:3}]},{name:"Artisans",type:1,rewards:[{kind:"military",type:"fixed",amount:1},{kind:"work",type:"fixed",amount:3},{kind:"influence",type:"fixed",amount:3}]},{name:"Canoe",type:3,rewards:[{kind:"exploration",type:"fixed",amount:3},{kind:"military",type:"fixed",amount:1}]},{name:"Symbology",type:2,rewards:[{kind:"ideas2",type:"percentage",amount:5}]}],[{name:"Brewing",type:3,rewards:[{kind:"health",type:"fixed",amount:4}]},{name:"Expeditions",type:1,rewards:[{kind:"exploration",type:"fixed",amount:4}]},{name:"Irrigation",type:2,rewards:[{kind:"growth",type:"fixed",amount:4},{kind:"work",type:"fixed",amount:2}]},{name:"Megaliths",type:1,rewards:[{kind:"influence",type:"fixed",amount:4}]},{name:"Weaving",type:3,rewards:[{kind:"work",type:"fixed",amount:4}]}],[{name:"Architecture",type:1,rewards:[{kind:"health",type:"fixed",amount:5},{kind:"influence",type:"fixed",amount:5}]},{name:"Sailing",type:3,rewards:[{kind:"exploration",type:"fixed",amount:5}]},{name:"Smelting",type:3,rewards:[{kind:"military",type:"fixed",amount:8},{kind:"work",type:"fixed",amount:4}]},{name:"Wheel",type:2,rewards:[{kind:"work",type:"fixed",amount:6}]}],[{name:"Bronze Working",type:3,rewards:[{kind:"military",type:"fixed",amount:4},{kind:"work",type:"fixed",amount:8}]},{name:"Government",type:1,rewards:[{kind:"exploration",type:"fixed",amount:2},{kind:"health",type:"fixed",amount:6}]},{name:"Horseback Riding",type:3,rewards:[{kind:"exploration",type:"fixed",amount:4},{kind:"military",type:"fixed",amount:3}]},{name:"Plough",type:2,rewards:[{kind:"growth",type:"fixed",amount:12}]},{name:"Writing",type:2,rewards:[{kind:"ideas1",type:"percentage",amount:5},{kind:"ideas2",type:"percentage",amount:5},{kind:"ideas3",type:"percentage",amount:5}]}],[{name:"Mathematics",type:2,rewards:[{kind:"ideas2",type:"percentage",amount:5}]},{name:"Monarchism",type:1,rewards:[{kind:"influence",type:"fixed",amount:12}]},{name:"Money",type:3,rewards:[{kind:"work",type:"fixed",amount:8},{kind:"influence",type:"fixed",amount:4}]},{name:"Shipbuilding",type:2,rewards:[{kind:"exploration",type:"fixed",amount:6},{kind:"military",type:"fixed",amount:2}]},{name:"Swords",type:2,rewards:[{kind:"military",type:"fixed",amount:6}]}],[{name:"Calendar",type:2,rewards:[{kind:"growth",type:"fixed",amount:16},{kind:"work",type:"fixed",amount:4}]},{name:"Law",type:1,rewards:[{kind:"military",type:"fixed",amount:6},{kind:"health",type:"fixed",amount:6}]},{name:"Libraries",type:3,rewards:[{kind:"ideas3",type:"percentage",amount:5},{kind:"influence",type:"fixed",amount:4}]},{name:"Sewers",type:3,rewards:[{kind:"health",type:"fixed",amount:10}]},{name:"Sundial",type:2,rewards:[{kind:"exploration",type:"fixed",amount:10},{kind:"work",type:"fixed",amount:4}]}]].map(e=>e.reduce((r,{name:t,type:a,rewards:d},p)=>(r[t]={position:p,level:1,type:a,rewards:d},r),{}));currency={people:0,ideas1:0,ideas2:0,ideas3:0,growth:0,health:0,military:0,influence:0,work:0,exploration:0};#e=!1;get openPage(){return this.upgradePages[this.openPageId]}save(){globalThis.localStorage.setItem("gameSave",btoa(JSON.stringify(this)))}load(e={}){return this.saveVersion=e.saveVersion??this.saveVersion,this.gameSpeed=e.gameSpeed??this.gameSpeed,this.openPageId=e.openPageId??this.openPageId,e.upgradePages&&(this.upgradePages=this.upgradePages.map((r,t)=>Object.fromEntries(Object.entries(r).map(([a,d])=>[a,{...d,level:e.upgradePages?.[t]?.[a]?.level??d.level}])))),this.currency=e.currency??this.currency,this}loadFromLocalStorage(){let e=globalThis.localStorage.getItem("gameSave");if(!e)return this;let r=JSON.parse(atob(e));if(Array.isArray(r)&&(r=r[0]),!r)return this;if(typeof r!="object"||Array.isArray(r))throw new Error("Invalid save data from localStorage");if(!r.saveVersion||r.saveVersion<1)throw new Error("Unsupported saveData version");return this.load(r)}deleteSave(){globalThis.localStorage.removeItem("gameSave");let e=new this.constructor;return this.saveVersion=e.saveVersion,this.gameSpeed=e.gameSpeed,this.openPageId=e.openPageId,this.upgradePages=e.upgradePages,this}registerAutoSave(){if(this.#e)throw new Error("Do not register autosave twice!");return document.addEventListener("visibilitychange",()=>{document.visibilityState=="hidden"&&this.save()}),window.addEventListener("pagehide",()=>this.save()),this.#e=!0,this}};var k=[["M",1e3],["CM",900],["D",500],["CD",400],["C",100],["XC",90],["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]];function g(n){let e="";for(let[r,t]of k)for(;n>=t;)e+=r,n-=t;return e}function l(n){n?.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}var o=document.querySelector("#upgrades-container"),i=document.querySelector("#upgrades-group-buttons"),I=[...new Set(document.querySelectorAll(":has(>.active)"))],f;for(let n of I)n.addEventListener("click",e=>{let r=e.target,t=r.closest("button");if(!t||!n.contains(t))return;let a=t.closest("li, .tab");a&&(n.querySelector(".active")?.classList.remove("active"),a.classList.add("active"),l(a))});o.addEventListener("click",n=>{if(!(n.target instanceof Element))return;let e=n.target.closest(".upgrade");if(!e)return;let r=game.openPage[e.querySelector(".up-name").textContent],t=e.querySelector(".up-level");r.level++,t.textContent=r.level.toLocaleString()});i.addEventListener("wheel",n=>{n.deltaY&&(n.preventDefault(),i.scrollLeft=Math.max(0,Math.min(i.scrollLeft+n.deltaY,i.scrollWidth-i.clientWidth)),clearTimeout(f),f=setTimeout(l,1e4))},{passive:!1});i.addEventListener("click",n=>{if(!(n.target instanceof HTMLButtonElement))return;let e=[...i.children].indexOf(n.target.parentElement);game.openPageId=e;let r=Object.entries(game.openPage);for(let[t,a]of r){let d=o.children.item(a.position);d.querySelector(".up-level").textContent=a.level.toLocaleString(),d.querySelector(".up-name").textContent=t,d.setAttribute("type",a.type.toString());let p=d.querySelector(".up-improvements-container"),C=p.querySelector(".up-imp");p.replaceChildren(...a.rewards.map(s=>{let u=C.cloneNode(!0);u.querySelector("p > .sign").textContent=s.amount>0?"+":"-",u.querySelector("p > .value").textContent=s.amount.toLocaleString(),u.querySelector("p > .unit").textContent=s.type=="percentage"?"%":"";let m=u.querySelector(".up-imp-icon");for(let h of Object.values(c))m.classList.remove(...h.split(" "));return m.classList.add(...c[s.kind].split(" ")),u})),d.classList.remove("hidden")}for(let t=r.length;t<o.children.length;t++)o.children.item(t)?.classList.add("hidden")});document.addEventListener("DOMContentLoaded",()=>{globalThis.game=new y().loadFromLocalStorage().registerAutoSave();for(let n=0;n<4;n++)o.append(o.firstElementChild.cloneNode(!0));for(let n=0;n<game.upgradePages.length;n++){let e;n?(e=document.createElement("li"),e.append(...i.firstElementChild.childNodes.values().map(r=>r.cloneNode()))):e=i.firstElementChild,e.children[0].textContent=g(n+1),n&&i.append(e)}l(i.children[game.openPageId]),i.children[game.openPageId].firstChild.click()});})();
//# sourceMappingURL=index.js.map
